💡 Solutions cho XAUUSD Strong Trend:
1. Phase 12 Enhanced: Conditional Basket SL (Đã có trong docs của bạn)
cpp// Chỉ activate Basket SL khi counter-trend
if (BUY basket && DOWNTREND) → Enable SL
if (SELL basket && UPTREND) → Enable SL
if (NEUTRAL/RANGE) → Disable SL (let grid work)
2. Trend Strength Filter - Tăng cường hơn nữa
cpp// Không chỉ block reseed, mà block luôn new basket trong extreme trend
if (ADX > 40 && Strong_Trend) {
    // EXTREME TREND - Grid sẽ fail
    → Block ALL counter-trend operations
    → Only trade with-trend or stay out
}
3. Dynamic Grid Spacing cho XAUUSD
cpp// XAUUSD volatility cao → cần spacing rộng hơn
Normal: 150 pips spacing
Strong Trend Detected: 
    → Auto increase to 300-500 pips spacing
    → Fewer positions, less exposure
4. Hedging Protection Mode (Mới)
Khi detect strong trend trap:
cppif (SELL basket trapped in uptrend) {
    // Mở hedge position
    Open BUY with larger lot (1.5x - 2x SELL volume)
    → Profit from trend while waiting SELL recovery
    → Close hedge when trend reverses
}
5. Time-Based Exit (Cắt lỗ theo thời gian)
cppif (Position_Age > 24 hours && DD > 20%) {
    // Trend đã kéo dài quá lâu
    → Accept loss and close
    → Better than holding for days
}
🛡️ Recommended Configuration cho XAUUSD:
cpp// Conservative Settings cho Strong Trend
InpBasketSL_Enabled = true
InpBasketSL_Spacing = 2.0  // Tighter SL (300 pips thay vì 375)
InpReseedMode = RESEED_TREND_AWARE
InpReseedCooldownMin = 120  // 2 hours cooldown

// Extreme Trend Protection
InpTrendStrengthThreshold = 35  // ADX threshold  
InpBlockNewBasketInExtremeTrend = true
InpDynamicSpacingEnabled = true
InpDynamicSpacingMultiplier = 2.0  // Double spacing in trend

// Quick Exit More Aggressive
InpQuickExitLossUSD = -30  // Accept larger loss to escape faster
InpQuickExitMode = QE_DYNAMIC
📊 Hybrid Strategy cho XAUUSD:
A. Trend Detection Layer:

EMA 200 - Primary trend
ADX > 30 - Trend strength
ATR - Volatility measurement
Price Action - Higher highs/lower lows

B. Decision Matrix:
Market State         | Action
--------------------|------------------
Range (ADX < 25)    | Full Grid (both baskets)
Weak Trend (25-35)  | Grid với Basket SL
Strong Trend (35-45)| Only with-trend basket
Extreme (> 45)      | Stop trading hoặc hedge
C. Recovery Strategy:
Khi bị trap trong strong trend:

Immediate: Quick Exit với negative TP
If Failed: Basket SL triggers
After SL: Wait for range hoặc reversal signal
Reseed: Only when safe (trend exhausted)

🔧 Code Implementation Suggestion:
Thêm class mới TrendStrengthManager:
cppclass TrendStrengthManager {
    double GetTrendStrength() {
        // Combine multiple indicators
        double adx = iADX(...);
        double atr = iATR(...);
        double ema_angle = CalculateEMAAngle();
        
        // Weighted score
        return (adx * 0.5 + atr_normalized * 0.3 + ema_angle * 0.2);
    }
    
    bool IsExtremeTrend() {
        return GetTrendStrength() > 0.7;  // 70% strength
    }
    
    int GetRecommendedSpacing() {
        double strength = GetTrendStrength();
        if (strength < 0.3) return base_spacing;
        if (strength < 0.5) return base_spacing * 1.5;
        if (strength < 0.7) return base_spacing * 2.0;
        return base_spacing * 3.0;  // Extreme trend
    }
}
✅ Practical Steps Forward:

Test Phase 12 implementation của bạn trước
Add Trend Strength scoring (ADX + ATR + EMA angle)
Implement Dynamic Spacing cho XAUUSD
Test Hedge Mode trên demo
Backtest 6 tháng với mixed conditions

📈 Expected Results:

Max DD: 50% → < 25%
Strong trend losses: -22% → < 10%
Recovery time: Days → Hours
Win rate in range: Maintain 60-70%